# 認証機能改善タスクリスト

## 1. パスワードハッシュ化の実装

### 1.1 bcrypt の導入

- [ ] bcrypt パッケージのインストール
- [ ] パスワードハッシュ化ユーティリティの作成
- [ ] 既存パスワードの移行計画

### 1.2 ログイン API 改修

- [ ] パスワード比較ロジックの修正
- [ ] エラーハンドリングの改善
- [ ] テストケースの追加

## 2. ロールベースアクセス制御

### 2.1 ミドルウェア改修

- [ ] ロールチェック機能の追加
- [ ] 権限エラー時のリダイレクト設定
- [ ] テストケースの追加

### 2.2 API ルート保護

- [ ] 管理者専用ルートの保護
- [ ] 一般ユーザールートの保護
- [ ] エラーレスポンスの統一

## 3. セキュリティ強化

### 3.1 トークン管理

- [ ] トークン有効期限の設定
- [ ] リフレッシュトークンの検討
- [ ] トークン無効化機能の実装

### 3.2 CSRF 対策

- [ ] CSRF トークンの実装
- [ ] Secure Cookie 設定の見直し
- [ ] テストケースの追加

## 4. エラーハンドリング

### 4.1 エラーメッセージ

- [ ] エラーメッセージの国際化
- [ ] エラーコードの整理
- [ ] クライアントエラー表示の改善

### 4.2 ログ管理

- [ ] 認証エラーのログ記録
- [ ] セキュリティイベントの監視
- [ ] ログローテーションの設定

## 5. テスト強化

### 5.1 単体テスト

- [ ] パスワードハッシュ化のテスト
- [ ] トークン検証のテスト
- [ ] 権限チェックのテスト

### 5.2 E2E テスト

- [ ] ログインフローのテスト
- [ ] 権限エラーのテスト
- [ ] セッション管理のテスト

## 実装優先順位

1. パスワードハッシュ化(セキュリティ上最重要)
2. ロールベースアクセス制御(基本機能として必須)
3. API ルート保護(セキュリティ強化)
4. トークン管理(セッション管理の改善)
5. エラーハンドリング(ユーザビリティ向上)

## 想定工数

- パスワードハッシュ化: 2 時間
- ロールベースアクセス制御: 3 時間
- API ルート保護: 2 時間
- トークン管理: 2 時間
- エラーハンドリング: 2 時間
- テスト実装: 3 時間

合計: 14 時間(約 2 日)

## 注意事項

1. パスワードハッシュ化実装時のデータ移行に注意
2. 権限チェックの漏れがないよう注意
3. セキュリティテストの徹底
4. 既存機能への影響確認

## 成功基準

1. 全てのパスワードがハッシュ化されている
2. 権限に応じたアクセス制御が機能している
3. 全てのテストが成功している
4. セキュリティ上の脆弱性が解消されている
