# MVP 実装計画書

## 1. 実装範囲

### 1.1 認証機能

- メールアドレス/パスワードによる基本的な認証
- ロール: 一般ユーザー、管理者の 2 種類
- セッション管理は最小限(JWT ベース)

### 1.2 取引先管理

- 基本的な CRUD 操作
- シンプルなタグ機能(1-2 個程度)
- 一覧表示は基本的なページネーションのみ

### 1.3 請求書管理

- 請求書の作成/編集
- PDF 出力機能
- ステータス管理(下書き/承認済み)
- 外部ユーザーによる請求書提出フロー

## 2. 技術スタック選定

### 2.1 フロントエンド

- Next.js 14(App Router)
  - 理由:SSR サポート、ルーティング機能、API ルート統合
- TailwindCSS
  - 理由:高速な開発、カスタマイズ性、メンテナンス性

### 2.2 バックエンド

- Prisma
  - 理由:型安全性、マイグレーション管理、クエリビルダー
- SQLite(開発)/ PostgreSQL(本番)
  - 理由:MVP フェーズではシンプルな構成を優先

### 2.3 認証

- NextAuth.js
  - 理由:Next.js との統合、JWT サポート、拡張性

### 2.4 PDF 生成

- react-pdf
  - 理由:React コンポーネントベースの柔軟な PDF 生成

## 3. 実装スケジュール

### Day 1: 認証基盤

- [x] 認証 API エンドポイント実装
- [x] ログイン/ログアウトフロー
- [x] 認証 E2E テスト

### Day 2-3: 取引先管理

- [ ] 取引先 CRUD API
- [ ] 取引先一覧/詳細画面
- [ ] タグ機能
- [ ] E2E テスト

### Day 4-5: 請求書管理

- [ ] 請求書 CRUD API
- [ ] 請求書作成/編集画面
- [ ] PDF 出力機能
- [ ] ステータス管理
- [ ] E2E テスト

### Day 6: 最終調整

- [ ] 結合テスト
- [ ] バグ修正
- [ ] パフォーマンス最適化

## 4. テスト方針

### 4.1 E2E テスト(Cypress)

- 主要フローのテスト
  - ログイン → ダッシュボード表示
  - 取引先 CRUD 操作
  - 請求書作成 →PDF 出力
- バリデーションテスト
- 権限チェック

### 4.2 単体テスト

- API エンドポイントのテスト
- バリデーションロジックのテスト
- PDF レンダリングのテスト

### 4.3 テスト環境

- 開発環境:SQLite データベース
- テスト前にデータベースをクリーンアップ
- CI での基本的な自動テスト実行

## 5. セキュリティ対策

### 5.1 認証・認可

- JWT によるセッション管理
- ロールベースのアクセス制御
- CSRF 対策

### 5.2 データ保護

- 入力値のバリデーション
- SQL インジェクション対策(Prisma)
- XSS 対策

## 6. 制約事項・除外機能

### 6.1 対応しない機能

- 複雑なセッション管理
- 高度な権限管理
- OCR による PDF 取り込み
- 複雑な税制対応

### 6.2 将来の拡張ポイント

- Redis 導入(セッション管理)
- 複雑な権限管理システム
- バッチ処理による大量データ対応
- 監査ログ機能

## 7. 成果物

### 7.1 必須成果物

- ソースコード
- E2E テストコード
- データベーススキーマ
- API 仕様書

### 7.2 ドキュメント

- セットアップガイド
- 基本操作マニュアル
- API 利用ガイド

## 8. リスク管理

### 8.1 想定されるリスク

- PDF 生成の処理負荷
- データベースのパフォーマンス
- セッション管理の制限

### 8.2 対策

- PDF 生成の非同期処理検討
- インデックス最適化
- スケーラビリティを考慮した設計

## 9. 成功基準

- 基本的な CRUD 操作が正常に動作すること
- PDF 出力が正常に行えること
- E2E テストが全て成功すること
- セキュリティ上の重大な脆弱性がないこと

以上の計画に基づき、5-6 日で MVP を完成させることを目指します。
